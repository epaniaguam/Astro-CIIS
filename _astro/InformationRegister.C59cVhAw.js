import{j as e}from"./jsx-runtime.2X-s0L5T.js";import{r as u}from"./index.DeEakWXg.js";import{s as r}from"./index.fa162945.paza8D94.js";import{u as G,c as M,a as n,b as W}from"./index.esm.BXCdRTLJ.js";import{U as k}from"./endpoints.DprMjbcE.js";import{u as b,D as y}from"./Dialog.DmsGN8OU.js";import{u as q}from"./use-auth.D9FCaERX.js";import{A as R}from"./AuthContext._-l9kgW4.js";import{I as N,a as w}from"./IconEyeOff.Bi53Z45a.js";import{n as O,a as I}from"./nationalities.BY9lUa14.js";import"./index.35f4d4a6.DGW6ehmJ.js";import"./auth.B43UY8jh.js";const z=({evento:i,plan:o})=>{const{user:f,createSession:l,updateStatusUser:c}=q(),[t,d]=u.useState(!1),[g,h]=u.useState(""),[v,E]=u.useState(!1),[$,F]=u.useState(!1),x=b(),p=b(),s=G(V({plan:o,success:a=>{c(a),x.handleOpen(),i==="postmaster"?setTimeout(()=>{l(a,`/postmaster/registro/pago/${o}`)},2e3):i==="ciis"?setTimeout(()=>{l(a,`/registro/pago/${o}`)},2e3):i==="ciis_workshop"&&setTimeout(()=>{l(a,`/workshops/pago/${o}`)},2e3)},abort:a=>{const{error:j="Ha ocurrido un error",reason:m="En este momento el servidor no está disponible, inténtelo más tarde"}=a;h(m),p.handleOpen()},setLoading:d})),P=async()=>{try{const a=s.values.dni,m=await(await fetch(`https://api.perudevs.com/api/v1/dni/simple?document=${a}&key=cGVydWRldnMucHJvZHVjdGlvbi5maXRjb2RlcnMuNjUxZWM4ZmViMzEyMDcwMDhlODA5MmM2`)).json();if(m.estado&&m.resultado){const{nombres:S,apellido_paterno:C,apellido_materno:D}=m.resultado;s.setFieldValue("name",S),s.setFieldValue("lastname",`${C} ${D}`)}else h("No se encontró el DNI"),p.handleOpen()}catch{h("Error al buscar DNI"),p.handleOpen()}};return u.useEffect(()=>{i==="postmaster"?s.setFieldValue("plan_postmaster",o):i==="ciis"&&s.setFieldValue("plan_ciis",o)},[i,o]),e.jsxs(e.Fragment,{children:[e.jsx(y,{style:{top:20,position:"fixed"},icon:"success",message:"Registro exitoso. Estás a un solo paso de ser parte de este evento.",open:x.open,onClose:x.handleClose}),g&&e.jsx(y,{style:{top:20,position:"fixed"},icon:"warning",message:g,open:p.open,onClose:p.handleClose}),e.jsxs("div",{className:`${r.formContainer} bg-blue-950/50`,children:[e.jsxs("div",{className:`${r.formGroup}`,children:[e.jsx("label",{htmlFor:"dni",children:"Selecciona tu nacionalidad"}),e.jsx("div",{className:`${r.inputWrapper}`,children:e.jsxs("select",{...s.getFieldProps("nationality"),className:`${s.touched.nationality&&s.errors.nationality?r.inputInvalid:""}`,children:[e.jsx("option",{value:"",children:"Seleccione"}),O.map((a,j)=>e.jsx("option",{value:a.key,children:a.value},j))]})}),s.touched.nationality&&s.errors.nationality?e.jsx("span",{className:`${r.textInvalid}`,children:s.errors.nationality}):null]}),e.jsxs("div",{className:`${r.formGroup}`,children:[e.jsx("label",{htmlFor:"dni",children:"Ingresa tu documento de identidad"}),e.jsxs("div",{className:`${r.inputWrapper}`,children:[e.jsx("input",{type:"text",placeholder:"Ejemplo: 72721212",...s.getFieldProps("dni"),className:`${s.touched.dni&&s.errors.dni?r.inputInvalid:""}`}),s.values.nationality==="Perú"&&e.jsx("button",{className:`${r.searchButton}`,onClick:P,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",children:e.jsx("path",{d:"M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"})})})]}),s.touched.dni&&s.errors.dni?e.jsx("span",{className:`${r.textInvalid}`,children:s.errors.dni}):null]}),e.jsxs("div",{className:`${r.formGroup}`,children:[e.jsx("label",{htmlFor:"name",children:"Ingresa tus nombres"}),e.jsx("div",{className:`${r.inputWrapper}`,children:e.jsx("input",{type:"text",placeholder:"Ejemplo: Jose Ricardo Manuel",...s.getFieldProps("name"),className:`${s.touched.name&&s.errors.name?r.inputInvalid:""}`})}),s.touched.name&&s.errors.name?e.jsx("span",{className:`${r.textInvalid}`,children:s.errors.name}):null]}),e.jsxs("div",{className:`${r.formGroup}`,children:[e.jsx("label",{htmlFor:"lastname",children:"Ingresa tus apellidos"}),e.jsx("div",{className:`${r.inputWrapper}`,children:e.jsx("input",{type:"text",placeholder:"Ejemplo: Mamani Jimenez Garcia",...s.getFieldProps("lastname"),className:`${s.touched.lastname&&s.errors.lastname?r.inputInvalid:""}`})}),s.touched.lastname&&s.errors.lastname?e.jsx("span",{className:`${r.textInvalid}`,children:s.errors.lastname}):null]}),e.jsxs("div",{className:`${r.formGroup}`,children:[e.jsx("label",{htmlFor:"phone",children:"Ingresa tu número de teléfono"}),e.jsx("div",{className:`${r.inputWrapper}`,children:e.jsx("input",{type:"text",placeholder:"Ejemplo: 984321987",...s.getFieldProps("phone"),className:`${s.touched.phone&&s.errors.phone?r.inputInvalid:""}`})}),s.touched.phone&&s.errors.phone?e.jsx("span",{className:`${r.textInvalid}`,children:s.errors.phone}):null]}),e.jsxs("div",{className:`${r.formGroup}`,children:[e.jsx("label",{htmlFor:"studycenter",children:"Ingresa el nombre de tu universidad"}),e.jsx("div",{className:`${r.inputWrapper}`,children:e.jsx("input",{type:"text",placeholder:"Ejemplo: Universidad Nacional Jorge Bas...",...s.getFieldProps("studycenter"),className:`${s.touched.studycenter&&s.errors.studycenter?r.inputInvalid:""}`})}),s.touched.studycenter&&s.errors.studycenter?e.jsx("span",{className:`${r.textInvalid}`,children:s.errors.studycenter}):null]}),e.jsxs("div",{className:`${r.formGroup}`,children:[e.jsx("label",{htmlFor:"career",children:"Ingresa el nombre de tu carrera profesional"}),e.jsx("div",{className:`${r.inputWrapper}`,children:e.jsx("input",{type:"text",placeholder:"Ejemplo: Ingeniería en informática y siste...",...s.getFieldProps("career"),className:`${s.touched.career&&s.errors.career?r.inputInvalid:""}`})}),s.touched.career&&s.errors.career?e.jsx("span",{className:`${r.textInvalid}`,children:s.errors.career}):null]}),e.jsxs("div",{className:`${r.formGroup}`,children:[e.jsx("label",{htmlFor:"email",children:"Ingresa tu correo electrónico"}),e.jsx("div",{className:`${r.inputWrapper}`,children:e.jsx("input",{type:"email",placeholder:"Ejemplo: example@gmail.com",...s.getFieldProps("email"),className:`${s.touched.email&&s.errors.email?r.inputInvalid:""}`})}),s.touched.email&&s.errors.email?e.jsx("span",{className:`${r.textInvalid}`,children:s.errors.email}):null]}),e.jsxs("div",{className:`${r.formGroup}`,children:[e.jsx("label",{htmlFor:"password",children:"Ingresa tu contraseña"}),e.jsxs("div",{className:`${r.inputWrapper}`,children:[e.jsx("input",{type:v?"text":"password",placeholder:"Puede ser diferente a la de tu correo",...s.getFieldProps("password"),className:`${s.touched.password&&s.errors.password?r.inputInvalid:""}`}),e.jsx("button",{type:"button",onClick:()=>E(a=>!a),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400",children:v?e.jsx(N,{size:24,color:"white"}):e.jsx(w,{size:24,color:"white"})})]}),s.touched.password&&s.errors.password?e.jsx("span",{className:`${r.textInvalid}`,children:s.errors.password}):null]}),e.jsxs("div",{className:`${r.formGroup}`,children:[e.jsx("label",{htmlFor:"confPassword",children:"Ingresa nuevamente tu contraseña"}),e.jsxs("div",{className:`${r.inputWrapper}`,children:[e.jsx("input",{type:$?"text":"password",placeholder:"Repite la anterior contraseña",...s.getFieldProps("confPassword"),className:`${s.touched.confPassword&&s.errors.confPassword?r.inputInvalid:""}`}),e.jsx("button",{type:"button",onClick:()=>F(a=>!a),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400",children:$?e.jsx(N,{size:24,color:"white"}):e.jsx(w,{size:24,color:"white"})})]}),s.touched.confPassword&&s.errors.confPassword?e.jsx("span",{className:`${r.textInvalid}`,children:s.errors.confPassword}):null]}),e.jsx("div",{className:`${r.submitButtonWrapper}`,children:e.jsx("button",{type:"button",className:`${r.submitButton}`,onClick:a=>s.handleSubmit(a),disabled:t,children:"Confirmar Información"})})]})]})};function V({plan:i,success:o,abort:f,setLoading:l}){return{initialValues:{nationality:"",dni:"",name:"",lastname:"",email:"",password:"",confPassword:"",studycenter:"",career:"",phone:"",plan_ciis:"",plan_postmaster:""},validationSchema:M().shape({nationality:n().required("Este campo es obligatorio"),dni:n().matches(/^[0-9]+$/,"Debe contener solo números").required("Este campo es obligatorio").test({name:"dni",skipAbsent:!0,test(c,t){let d=t.parent.nationality;return c.length!==I[d]?t.createError({message:`Deben ser ${I[d]} caracteres`}):!0}}),name:n().required("Este campo es obligatorio"),lastname:n().required("Este campo es obligatorio"),email:n().email("Debe ser un email válido").required("Este campo es obligatorio"),password:n().min(6,"Debe tener al menos 6 caracteres").required("Este campo es obligatorio"),confPassword:n().oneOf([W("password"),void 0],"Las contraseñas deben coincidir").required("Este campo es obligatorio"),phone:n().matches(/^([0-9]{9})|(\+[0-9]{2,3} [0-9]{9})$/,"El formato no es válido").required("Es necesario para poder contactarlo"),studycenter:n().required("Este campo es obligatorio"),career:n().required("Este campo es obligatorio")}),onSubmit:c=>{l(!0),fetch(k.user.src,{method:"POST",body:JSON.stringify(c),headers:{"Content-Type":"application/json"},credentials:"include"}).then(async t=>{if(t.ok)return t.json();throw await t.json()}).then(o).catch(t=>{f(t),l(!1)})}}}const se=({evento:i,plan:o})=>e.jsx(R,{children:e.jsx(z,{evento:i,plan:o})});export{se as default};
