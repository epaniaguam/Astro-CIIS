import{j as e}from"./jsx-runtime.2X-s0L5T.js";import{r as t}from"./index.DeEakWXg.js";import{s as r}from"./index.522a1821.BBumnH-X.js";import{u as D,c as T,a as w,b as z}from"./index.esm.BXCdRTLJ.js";import{U as j}from"./endpoints.DprMjbcE.js";import{u as g,D as c}from"./Dialog.DmsGN8OU.js";import{I as y,a as v}from"./IconEyeOff.Bi53Z45a.js";import"./index.35f4d4a6.DGW6ehmJ.js";function J(){const[b,P]=t.useState(!1),[l,d]=t.useState(null),[S,N]=t.useState(null),[p,C]=t.useState(null),[u,k]=t.useState(!1),[m,E]=t.useState(!1),h=g(),n=g(),f=new URLSearchParams(location.search),[x,I]=t.useState();function O(s=i=>{}){return{initialValues:{password:"",confPassword:""},validationSchema:T().shape({password:w().required("Este campo es obligatorio"),confPassword:w().oneOf([z("password"),void 0],"Las contraseñas deben coincidir").required("Este campo es obligatorio")}),onSubmit:i=>{s(!0),fetch(j.user.restore,{method:"POST",body:JSON.stringify({...i,email:x?.email,code:x?.code}),headers:{"Content-Type":"application/json"},credentials:"include"}).then(async o=>{if(o.ok)return o.json();throw await o.json()}).then(()=>{N("Se ha completado la restauración la contraseña. Puede iniciar sesión con su cuenta."),h.handleOpen(),s(!1)}).catch(o=>{o?.reason?(d(o.reason),n.handleOpen()):(d("Ha ocurrido un error inesperado"),n.handleOpen()),s(!1)})}}}const a=D(O(P)),R=(s,i)=>{fetch(j.user.verify,{method:"POST",body:JSON.stringify({code:s,token:i}),headers:{"Content-Type":"application/json"},credentials:"include"}).then(async o=>{if(o.ok)return o.json();throw await o.json()}).then(o=>{I({code:s,email:o.email_user})}).catch(o=>{C(o.reason),n.handleOpen()})};return t.useEffect(()=>{let s=f.get("code")||null,i=f.get("token")||null;R(s,i)},[]),e.jsxs(e.Fragment,{children:[e.jsx(c,{style:{top:20,position:"fixed"},icon:"success",message:S,open:h.open,onClose:()=>{location.href="/"}}),l&&e.jsx(c,{style:{top:20,position:"fixed"},icon:"warning",message:l,open:n.open,onClose:n.handleClose}),p&&e.jsx(c,{style:{top:20,position:"fixed"},icon:"warning",message:p,open:n.open,onClose:()=>{location.href="/"}}),e.jsxs("div",{className:"p-5 px-8 md:px-12 pt-32 rounded-lg w-[96%] max-w-[768px] mx-auto my-5",children:[e.jsx("h2",{className:"text-center text-primary-600 text-4xl font-bold py-6",children:"Restauración de contraseña"}),e.jsx("p",{className:r.description,children:"Ingresa tu nueva contraseña para volver a acceder a tu cuenta."}),e.jsxs("div",{className:r.formContainer,children:[e.jsxs("div",{className:r.formGroup,children:[e.jsx("label",{children:"Nueva contraseña"}),e.jsxs("div",{className:r.inputWrapper,children:[e.jsx("input",{type:u?"text":"password",placeholder:"Ingrese nueva contraseña",...a.getFieldProps("password"),className:`${a.touched.password&&a.errors.password?r.inputInvalid:""}`}),e.jsx("button",{type:"button",onClick:()=>k(s=>!s),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400",children:u?e.jsx(y,{size:24,color:"white"}):e.jsx(v,{size:24,color:"white"})})]}),a.touched.password&&a.errors.password?e.jsx("span",{className:`${r.textInvalid}`,children:a.errors.password}):null]}),e.jsxs("div",{className:r.formGroup,children:[e.jsx("label",{children:"Repetir nueva contraseña"}),e.jsxs("div",{className:r.inputWrapper,children:[e.jsx("input",{type:m?"text":"password",placeholder:"Repite nueva contraseña",...a.getFieldProps("confPassword"),className:`${a.touched.confPassword&&a.errors.confPassword?r.inputInvalid:""}`}),e.jsx("button",{type:"button",onClick:()=>E(s=>!s),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400",children:m?e.jsx(y,{size:24,color:"white"}):e.jsx(v,{size:24,color:"white"})})]}),a.touched.confPassword&&a.errors.confPassword?e.jsx("span",{className:`${r.textInvalid}`,children:a.errors.confPassword}):null]}),e.jsx("div",{className:r.submitButtonWrapper,children:e.jsx("button",{type:"button",className:r.submitButton,onClick:s=>a.handleSubmit(s),disabled:b,children:"Restaurar"})})]})]})]})}export{J as default};
